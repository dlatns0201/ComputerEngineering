# 컴퓨터 네트워크

# 목차
- [기본 용어](#기본-용어)
- [TCP/IP](#TCP/IP)
    - [TCP/IP 개요](#TCP/IP-개요)
    - [Network Access Layer](#1.-Network-Access-Layer)
    - [Internet Layer](#2.-Internet-Layer)
    - [Transport Layer](#3.-Transport-Layer)
    - [Application Layer](#4.-Application-Layer)
- [네트워크 장비](#네트워크-장비)
- [웹 브라우저가 웹 서버와 통신하는 과정](#웹-브라우저가-웹-서버와-통신하는-과정)
- [VPN](#VPN)

# 기본 용어
네트워크: 두 대이상의 컴퓨터가 연결되 데이터를 서로 주고 받는 통신망

인터넷: TCP/IP 프로토콜을 사용하는 세계 최대 규모의 네트워크

패킷
- 네트워크를 통해 전송되는 데이터 단위
- 데이터를 작은 단위로 쪼개어 네트워크의 대역폭을 점유를 최소화 시킨다.

DMZ: 인터넷과 내부 네트워크 사이에 위치한 네트워크로, 외부 공격자가 내부 네트워크에 침투하는 것을 막는 역할을 한다.

On-Premise: 사내 또는 데이터 센터에 서버를 두고 운영하는 것 VS 클라우드

프로토콜: 컴퓨터 간 통신을 위한 규칙이나 표준

OSI Model's 7 layer
1. Physical Layer
2. Data Link Layer
3. Network Layer
4. Transport Layer
5. Session Layer: 세션 체결, 통신 방식 결정
6. Presentation Layer: 문자 코드, 압축, 암호화 등 데이터 변환을 담당
7. Application Layer: 이메일 및 파일 전송, 웹 사이트 조회 등 어플리케이션 관련 서비스를 제공

# TCP/IP
## TCP/IP 개요
TCP/ IP protocol's 4 Layer
- 각 계층은 독립적이어서 데이터가 캡슐화, 역캡슐화 과정에 다른 계층의 영향을 받지 않는다.
- 각 Layer에서 다른 컴퓨터에게 데이터를 전송하기 위해 데이터 전송에 필요한 정보인 헤더를 붙이는 과정을 캡슐화라고 한다.

## 1. Network Access Layer
### Physical Layer
- OSI Model의 Physical Layer에 속하는 기능
- 시스템 간의 물리적인 연결과 전기 신호를 변환 및 제어
- 랜 카드로 디지털 데이터를 아날로그 데이터로 변경하거나 반대로 복호화도 한다.
- 컴퓨터와 네트워크 장비간의 연결을 담당

### Data-link Layer
- OSI Model의 Data-link Layer에 속하는 기능
- 네트워크 기기 간의 데이터 전송 및 물리 주소를 결정
- 네트워크 장비 간에 신호를 주고받은 규칙을 정함
- 허브 사용시, 이더넷 프로토콜의 CSMA/CD방식으로 여러 컴퓨터의 데이터 전송으로 생기는 충돌을 방지한다.
- 이더넷 헤더는 목적지 MAC 주소(6byte), 출발지 MAC 주소(6byte), 유형(2byte)로 이루어짐
    - 유형은 전송되는 상위 계층의 프로토콜 종류를 나타냄
- Trailer(Frame Check Sequence)는 데이터 전송 도중 오류가 있는지 확인하는 CheckSum이다.
- 이더넷 헤더와 Trailer가 붙은 데이터를 프레임이라고 한다.

## 2. Internet Layer
- 다른 네트워크와 통신하기 위한 경로 설정 및 논리 주소 결정
- 라우터 기기는 목적지 IP 주소까지 데이터를 보낼 경로를 지정해주는 라우팅을 담당한다.
- IP Header가 붙은 데이터를 IP 패킷이라고 한다.
- Public IP를 모든 컴푸터에게 할당하기엔 개수가 부족해 라우터에만 할당하고 LAN안의 기기들은 Private IP를 사용한다.
- IP의 1 옥텟의 주소 범위에 따라 class가 나뉘어진다.
    - A 클래스: 00000000~01111111
        - Private IP의 주소는 10.0.0.0 ~ 10.255.255.255
    - B 클래스: 10000000~10111111
        - Private IP의 주소는 172.16.0.0 ~ 172.31.255.255
    - C 클래스: 11000000~11011111
        - Private IP의 주소는 192.168.0.0 ~ 192.168.255.255
- 호스트 ID가 0이면 해당 작은 네트워크를 식별하는 주소, 호스트 ID가 255이면 해당 네트워크의 모든 기기로 데이터를 전송하는 브로드캐스트 주소이다.

### 서브넷팅
- 큰 네트워크를 작은 네트워크로 분할해 브로드 캐스트의 전송 범위를 줄이는 것
- 호스트 ID의 앞 비트를 서브넷 ID로 빌려 사용한다.
- 서브넷 마스크는 네트워크 주소(네트워크 ID + 서브넷 ID)와 호스트 주소를 식별해준다.

### 라우터를 통한 데이터 전송
라우터는 스위치가 연결된 포트에 Public IP를 지정해주는데 이것을 기본 게이트웨이라고 부른다.
- 임의의 LAN에서 다른 LAN의 기기와 통신하기 위해선 우선 자신이 속해있는 네트워크의 라우터 IP인 기본 게이트웨이로 데이터를 보내야한다.
- 라우터는 라우터 간에 경로 정보를 교환해 라우팅 테이블 정보를 자동으로 수정한다. 라우터 간 정보를 교환하기 위한 프로토콜을 라우팅 프로토콜이라고 한다.
    - ex) RIP, OSPF, BGP

### ARP
- 목적지 컴퓨터의 IP주소를 이용해 MAC 주소를 찾는 프로토콜으로 이더넷 프레임을 전송하기 위해 필요한 MAC 주소를 찾기 위해 사용한다.
- 프레임을 송신해야할 기기가 목적지의 MAC 주소를 알아내기 위해 네트워크에 브로드캐스트를 하는 ARP Request을 한다.
- 브로드캐스트로 응답을 받은 기기가 자신의 MAC 주소를 응답으로 보내는 것을 ARP Reply라고 한다.
- ARP를 통해 얻은 MAC주소를 IP들과 매핑해 메모리에 저장하는 형태를 ARP 테이블이라고 한다.
- 하지만 IP 주소가 변경되면 제대로 통신할 수 없어, RAM의 한 영역에서 일정 기간만 보존하는 ARP 캐시에 저장한다.

### ICMP
- ping 명령에 사용되는 프로토콜로, 목적지 컴퓨터에 ICMP 패킷을 전송하고 응답이 제대로 오는지 확인한다.


## 3. Transport Layer
- 신뢰할 수 있는 통신 구현
- Transport Layer의 특징을 간단하게 말하면 신뢰성, 정확성, 효율성이다.
- connection-oriented communication: 데이터 통신전, 연결을 확립한 뒤에 상대 기기와 요청과 응답을하면서 신뢰성있게 통신하는 방식(TCP)
- connectionless communication: 연결의 초기화 과정 없이, 일방적으로 데이터를 보내 효율성 있게 통신하는 방식(UDP)
- TCP 헤더가 붙은 데이터를 세그먼트라고 부른다.
- 대역폭: 정해진 시간 동안 전송될 수 있는 데이터 양

### TCP
- TCP 헤더에서 코드 비트(URG | ACK | PSH | RST | SYN | FIN)에서 연결을 확립하기 위해서 SYN와 ACK를 사용한다.
- 3-way Handshake: SYN -> ACK + SYN -> ACK
- 3(4)-way HandShake: FIN -> (ACK -> FIN) or (ACK + FIN) -> ACK
- Sequence Number: 송신측이 수신측에게 이 데이터가 몇 번째 데이터인지 알려주는 숫자
- Acknowlege Number: 송신측에게 몇 번째 데이터를 수신했다고 알려주는 숫자, n번째 데어터를 수신했을 때 n이 아닌 n+1를 응답으로 보냄
    - Sequence Number와 Acknowlege Number는 재전송 제어에 사용된다.

- 한번 데이터를 보내고 응답을 기다리는 것은 비효율적이라 여러개의 데이터를 보내고 응답을 기다리는 방식을 사용한다.
- 이것이 가능한건 세그먼트를 일시적으로 저장하는 Buffer가 있기 때문이다.
- Buffer가 Overflow가 되지 않도록 남은 Buffer의 용량을 담은 Window size를 TCP 헤더에 담아 보낸다.
    - 3-way HandShake 때 초기 Buffer(window size)를 알아낸다.
    - 첫 SYN 때 자신의 window size를 보내고 ACK를 받을 때 상대방의 window size를 알게 된다.
- 웹 브라우저로 접속할 때 자동으로 임의의 포트가 할당된다.

### UDP
- UDP 헤더가 붙은 데이터를 UDP 데이터 그램이라고 한다.
- 랜에 있는 기기들에게 데이터를 일괄적으로 보내는 브로드캐스트에도 사용된다.

## 4. Application Layer
- OSI Model의 Seesion Layer와 Presentation Layer도 이 계층에 속한다.
- 클라이언트의 요청을 전달하기 위해 통신 대상이 이해할 수 있는 형태인 메세지로 변환한 뒤 Transport Layer로 전달하는 역할을 한다.
- 다양한 응용 환경에서 공통적으로 필요한 기능을 다룬다.
- 클라이언트가 서버와 통신하기 위한 프로토콜을 사용한다.
- 웹 사이트 통신은 HTTP, 파일의 전송은 FTP, 메일을 보낼 땐 SMTP, 메일을 받을 땐 POP3을 사용하며 도메인 이름으로 IP 주소를 알아내는 것은 DNS를 사용한다.

### www(w3, web)
- HTML, URL, HTTP 세 기술을 사용한다.
- 클라이언트가 서버에게 데이터를 요청할 때 요청할 방식(ex.GET,POST)과 파일 이름, 버전 등을 헤더(or body)에 실어 보낸다.
- HTTP/1.0 버전은 요청을 보내고 나면 연결을 끊어 작업이 느리다.
- HTTP/1.1 버전부터 Keepalive 기능을 추가했는데, 연결이 한 번 수립되면 데이터 교환을 마칠 때까지 유지한다.
- HTTP/2 버전은 요청을 보낸 순서대로 응답을 반환하지 않아도 되어 콘텐츠를 빠르게 표시할 수 있다.

### DNS
- IP 주소대신 기억하기 쉬운 URL로 웹 사이트에 접속할 수 있게 사용되며, 도메인의 Name Resolution 담당을 하는 프로토콜
- 도메인 이름을 DNS 서버에게 요청해 해당하는 IP 주소를 응답받는다.
- 요청한 DNS 서버가 해당 도메인의 IP 주소를 모를 경우 다른 DNS 서버의 IP를 알려줘서 Name Resolution 요청을 하게 만든다.

### SMTP(port 25)
- 컴퓨터에서 메일 서버로 메일을 보내기 위한 프로토콜
- 메일 서버에서 다른 메일 서버로 메일을 보낼 때도 사용된다.
- 메일 서버엔 메일 박스라는 메일 보관 기능이 있어 메일을 저장한다.
- 통신 과정
1. 세션 시작 요청
2. 송신자의 메일 주소 통지 후 송신
3. 메일 수신자의 메일 주소 통지 후 송신
4. 메일 본문 송신을 통지 후 송신
5. 세션 종료 요청

### POP3(port 110)
- 컴퓨터가 메일 서버에게 메일을 받기 위한 프로토콜
- 메일을 수신할 때 사용자 이름과 비밀번호를 이용한 사용자 인증이 필요하다.
- 통신 가정(컴퓨터가 송신측)
1. 세션 시작 요청
2. 수신자의 사용자 이름 통지 후 송신
3. 수신자의 비밀번호를 통지 후 송신
4. 메일이 있는지 확인
5. 메일의 전송을 요청
6. 세션 종료 요청

### FTP
- 서버와 클라이언트 간에 파일을 전송하기 위한 프로토콜
- 데이터 전송은 20번 포트, 데이터 제어용은 21번 포트를 사용한다.

# 네트워크 장비
## 네트워크 케이블의 종류
1. 다이렉트 케이블
    - 구리 선 여덟개가 같은 순서로 커넥터에 연결된 케이블
    - 서로 다른 기기를 연결할 때 사용
    - 같은 기기간 연결에 사용하면 데이터의 충돌이 발생한다.
2. 크로스 케이블
    - 구리 선 여덟개 중 1,2번에 연결된 구리 선을 반대편 3,6번에 연결된 케이블
    - 같은 기기를 연결할 때 사용
- 두 케이블 모두 8개 중 1,2,3,6번 선만 사용한다.

## 허브
리피터: 전기 신호를 정형하고 증폭하는 기능으로, 먼 거리의 상대와 통신할 수 있게 한다.

허브
- 리피터기능과 더불어, 기기들을 연결하는 기능을 갖는다.
- 허브로 들어온 데이터는 특정 기기뿐 아니라 모든 기기에게 데이터를 전송한다. 그래서 스위치 사용을 선호한다.
- 모든 포트로 데이터가 전송되지만 헤더에 목적지 정보가 있고 프로토콜로 목적지 기기가 아니면 무시하는 규칙이 정해져있다.

## 스위치
- 포트번호와 연결된 기기의 MAC 주소를 매핑하는 MAC 주소 테이블이 존재한다.
- 기기에서 스위치로 프레임을 전송할 때 MAC 주소 테이블에 송신 기기의 MAc 주소가 없으면 포트번호와 해당 MAC 주소를 매핑시킨다.
- 프레임이 스위치에서 수신했지만 목적지 주소에 해당하는 기기 MAC가 MAC 주소 테이블에 없으면 모든 포트로 데이터를 전송하는 플러딩이 발생한다.
- 스위치는 MAC 주소 테이블을 참조해 목적지에 해당하는 기기에만 데이터를 전송하려고 한다. 
- 허브와 다르게 내부 구조는 Full-duplex로 설계되어 충돌이 발생하지 않는다.

# 웹 브라우저가 웹 서버와 통신하는 과정
- 3-way HandShake가 이루어졌다고 가정
1. HTTP 프로토콜을 이용해 URL 정보와 브라우저의 설정을 기반으로 HTTP 요청 헤더를 작성해 HTTP 메세지를 생성한다.
2. 브라우저가 출발지 포트번호로 1025번 이상의 포트번호를 임의로 설정하며 목적지 포트번호는 80번이 된다.
3. Transport Layer에서 Sequence Number 등 설정 후 세그먼트로 만든다.
4. 출발지 IP와 목적지 IP 정보를 첨부해 IP 패킷으로 만든다. 목적지 IP를 모를 경우 DNS로 알아낸다.
5. 출발지, 목적지 MAC 주소 등 정보를 첨부해 Frame으로 만든다. 목적지 MAC를 모를 경우 ARP로 알아낸다.
6. 랜 카드로 Physical Layer에서 디지털 데이터를 아날로그 전기 신호로 변환한다.

# VPN
가상 통신 터널을 만들어 기업의 본사, 지사같은 거점 간을 연결해 통신하거나 외부에서 인터넷으로 사내에 접속하는 것
- 인터넷 VPN
    - 거점 간 접속: IPsec이란 암호 기술 프로토콜을 사용해 접속함
    - 원격 접속 연결: 암호화된 통신로를 만듬, 외부에서 사용하는 컴퓨터와 사내 컴퓨터를 연결함
- IP-VPN
    - MPLS란 기술을 사용해 인터넷망이 아닌 통신 사업자 전용 폐쇄망을 사용
    - 해킹이나 데이터 변조의 위험이 없어 암호화 기능이 필요하지 않음